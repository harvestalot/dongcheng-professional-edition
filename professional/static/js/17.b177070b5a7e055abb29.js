webpackJsonp([17],{ZqPo:function(a,e){},zsCp:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("Dd8w"),i=t.n(r),c={data:function(){return{main_map_layer:"",reachabilityLayer:"",form_item_col:{label_col:{span:6},wrapper_col:{span:18}},medical_data:["大型医院","医院","诊所"],education_data:["幼儿园","小学","中学"],traffic_data:["地铁站","公交站","停车场"],handy_service_data:["超市","商场","便利店"],safety_data:["公园","广场","消防站"],cultural_resources_data:["文化资源"],travel_time_data:[{label:"10分钟",value:"10"},{label:"15分钟",value:"15"}],trip_mode_data:["步行"],search_criteria_params:{medical:[],education:[],traffic:[],handy_service:[],safety:[],cultural_resources:[],travel_time:"10"},current_search_criteria_str:"",centerpoint:"",reachability_data:[],area_cultural_resources_point_data:[]}},mounted:function(){this.init_map()},methods:{init_map:function(){var a=this;this.main_map_layer=new AMap.Map("accessibility_map",{mapStyle:"amap://styles/4ab81766c3532896d5b265289c82cbc6",resizeEnable:!0,center:[116.412255,39.908886],zoom:12}),this.reachabilityLayer=new Loca.PolygonLayer({map:this.main_map_layer,zIndex:1,fitView:!0,eventSupport:!1}),this.main_map_layer.on("click",function(e){a.reset_layer_data(),a.centerpoint=e.lnglat.lng+","+e.lnglat.lat,a.accessibility_initialize()})},reset_layer_data:function(){this.main_map_layer.clearMap(),this.reachabilityLayer&&this.reachabilityLayer.hide(),this.reachability_data=[],this.area_cultural_resources_point_data=[]},accessibility_initialize:function(){this.reset_layer_data();var a=new AMap.Marker({position:new AMap.LngLat(this.centerpoint.split(",")[0],this.centerpoint.split(",")[1]),offset:new AMap.Pixel(0,0),icon:"//vdata.amap.com/icons/b18/1/2.png"});this.main_map_layer.add(a),this.accessibility_range()},accessibility_range:function(){var a=this,e=this;this.http.getLocalhostJson(this.$Basice.reachability_url+"?centerpoint="+this.centerpoint+"&time="+this.search_criteria_params.travel_time,function(t){if("ok"===t.info){for(var r=[],i=0;i<t.result.split(";").length;i++){var c=t.result.split(";")[i];r.push([c.split(",")[0],c.split(",")[1]])}e.reachability_data=r,e.load_reachability_layer(),e.current_search_criteria_str.length>0&&e.get_accessibility_POI(),e.search_criteria_params.cultural_resources.length>0&&e.accessibility_resources()}else a.$message.info("获取可达性范围失败，请重新获取。")})},get_accessibility_POI:function(){var a=this;new AMap.PlaceSearch({});AMap.service(["AMap.PlaceSearch"],function(){var e=new AMap.PlaceSearch({pageSize:50,pageIndex:1,map:a.main_map_layer,autoFitView:!0}),t=new AMap.Polygon({path:a.reachability_data});e.searchInBounds(a.current_search_criteria_str,t,function(a,e){})})},accessibility_resources:function(){var a=this;this.http.getLocalhostJson("../../static/json/cultural/cultural_resources.json",function(e){for(var t=0;t<e.length;t++){var r=e[t];AMap.GeometryUtil.isPointInRing(r.lnglat,a.reachability_data)&&a.area_cultural_resources_point_data.push(i()({},r,{icon:"../../static/img/cultural/wenhuayichan_4.png"}))}console.log(a.area_cultural_resources_point_data),a.render_point_layer()})},render_point_layer:function(){var a=this;a.area_cultural_resources_point_data.forEach(function(e){(e=new AMap.Marker({map:a.main_map_layer,icon:new AMap.Icon({size:new AMap.Size(32,32),image:e.icon,imageOffset:new AMap.Pixel(0,0),imageSize:new AMap.Size(-16,-16)}),extData:e,position:e.lnglat})).on("click",function(e){var t=e.target.B.extData,r=[];r.push('<div class="info_window">'+t.name+"</div>"),r.push('<div class="info_window">地址：'+t.address+"</div>"),new AMap.InfoWindow({content:r.join("")}).open(a.main_map_layer,t.lnglat)})})},load_reachability_layer:function(){this.reachabilityLayer.setData([{lnglat:this.reachability_data}],{lnglat:"lnglat"}),this.reachabilityLayer.setOptions({style:{color:"#35F8BA",opacity:.2}}),this.reachabilityLayer.render(),this.reachabilityLayer.show()},handleSubmit:function(a){a.preventDefault();var e=this.search_criteria_params.medical.concat(this.search_criteria_params.education,this.search_criteria_params.traffic,this.search_criteria_params.handy_service,this.search_criteria_params.safety,this.search_criteria_params.cultural_resources);this.current_search_criteria_str=e.join("|"),this.centerpoint?this.accessibility_initialize():this.$message.info("请您现在地图上选取中心点。")},handleReset:function(){this.reset_layer_data(),this.centerpoint="",this.search_criteria_params={medical:[],education:[],traffic:[],handy_service:[],safety:[],cultural_resources:[],travel_time:"10"}}}},s={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"h_100 po_r"},[t("div",{staticClass:"w_100 h_100",attrs:{id:"accessibility_map"}}),a._v(" "),t("div",{staticClass:"search_criteria"},[t("a-form",[t("a-form-item",{attrs:{label:"医疗","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-checkbox-group",{attrs:{options:a.medical_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{staticStyle:{color:"red"}},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.medical,callback:function(e){a.$set(a.search_criteria_params,"medical",e)},expression:"search_criteria_params.medical"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"教育","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-checkbox-group",{attrs:{options:a.education_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{staticStyle:{color:"red"}},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.education,callback:function(e){a.$set(a.search_criteria_params,"education",e)},expression:"search_criteria_params.education"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"交通","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-checkbox-group",{attrs:{options:a.traffic_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{staticStyle:{color:"red"}},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.traffic,callback:function(e){a.$set(a.search_criteria_params,"traffic",e)},expression:"search_criteria_params.traffic"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"便民","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-checkbox-group",{attrs:{options:a.handy_service_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{staticStyle:{color:"red"}},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.handy_service,callback:function(e){a.$set(a.search_criteria_params,"handy_service",e)},expression:"search_criteria_params.handy_service"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"安全","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-checkbox-group",{attrs:{options:a.safety_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{staticStyle:{color:"red"}},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.safety,callback:function(e){a.$set(a.search_criteria_params,"safety",e)},expression:"search_criteria_params.safety"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"东西城区","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-checkbox-group",{attrs:{options:a.cultural_resources_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{staticStyle:{color:"red"}},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.cultural_resources,callback:function(e){a.$set(a.search_criteria_params,"cultural_resources",e)},expression:"search_criteria_params.cultural_resources"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"出行时间","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-radio-group",{attrs:{options:a.travel_time_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{},[a._v(a._s(r))])}}]),model:{value:a.search_criteria_params.travel_time,callback:function(e){a.$set(a.search_criteria_params,"travel_time",e)},expression:"search_criteria_params.travel_time"}})],1),a._v(" "),t("a-form-item",{attrs:{label:"出行方式","label-col":a.form_item_col.label_col,"wrapper-col":a.form_item_col.wrapper_col}},[t("a-radio-group",{attrs:{options:a.trip_mode_data},scopedSlots:a._u([{key:"label",fn:function(e){var r=e.value;return t("span",{},[a._v(a._s(r))])}}]),model:{value:a.trip_mode_data[0],callback:function(e){a.$set(a.trip_mode_data,0,e)},expression:"trip_mode_data[0]"}})],1),a._v(" "),t("a-form-item",{attrs:{"wrapper-col":{span:a.form_item_col.wrapper_col.span,offset:24-a.form_item_col.wrapper_col.span}}},[t("a-button",{attrs:{type:"primary"},on:{click:a.handleSubmit}},[a._v("确定")]),a._v(" "),t("a-button",{style:{marginLeft:"20px"},on:{click:a.handleReset}},[a._v("重置")]),a._v(" "),t("a-button",{style:{marginLeft:"20px"},attrs:{type:"primary"}},[t("router-link",{attrs:{to:{name:"Home"}}},[a._v("返回")])],1)],1)],1)],1)])},staticRenderFns:[]};var l=t("VU/8")(c,s,!1,function(a){t("ZqPo")},"data-v-2f98fc9a",null);e.default=l.exports}});